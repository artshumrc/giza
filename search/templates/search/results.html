{% extends "base.html" %}
{% load static wagtailcore_tags %}
{% load search_tags %}

{% block body_class %}section-search-body{% endblock %}

{% block title %}Digital Giza | Search the Archives{% endblock %}

{% block content %}
<div class="page-header header-bg-5" id="content">
  <div class="row title">
    <header class="large-12 columns">
      <h1>Search the Archives <a name="top"></a></h1>
    </header>
  </div>
</div>

<div class="row">

  <section class="medium-9 medium-push-3 columns">

    <div class="row">
      <div class="medium-6 columns">
        <h3 class="heading-alt m-t-half m-b-1">{{ total }} search result{{ total|length|pluralize }} found.</h3>
      </div>
      <!-- <div class="medium-3 columns text-right">
        <label for="sortResults" class="middle m-r-neg1">Sort by:</label>
      </div>
      <div class="medium-3 columns">
        <select id="sortResults">
          <option value="">Category</option>
          <option value="">Name</option>
          <option value="">Year</option>
          <option value="">Material</option>
          <option value="">Findspot</option>
        </select>
      </div> -->
    </div>

    {% for result in hits %}
      <div class="media-object list-item search-result">
        <div class="media-object-section">
          <div {% if result.source.primarydisplay %}class="thumbnail"{% endif %}>
            <a href="#0">{% if result.source.primarydisplay %}<img src="{{ result.source.primarydisplay.thumbnail }}" alt="">{% endif %}</a>
          </div>
        </div>
        <div class="media-object-section">
          <p class="media-object-title"><a href="{% url 'get_type_html' result.type result.id 'intro' %}">{{ result.source.displaytext }}</a></p>
          <ul class="subheader">
            <li>{{ result.source.number }}</li>
            <!-- add category -->
          </ul>
        </div>
      </div>
    {% endfor %}
  </section>
  <aside class="medium-3 medium-pull-9 columns">

    <div class="feature-block secondary text-smaller">
      <h5 class="heading-alt">Search options</h5>
      <p><a href="{% url 'search' %}">Start a new search</a></p>

      <div class="search-facet-section">
        <h6 class="search-facet-title">Keyword:</h6>
        <ul class="search-facet-list">
          <li class="is-active">
            {{ search_query }}
          </li>
        </ul>
      </div>

      <div class="search-facet-section">
        <h6 class="search-facet-title">Category:</h6>
        <ul class="search-facet-list">
          <!-- Display selected categories first -->
          {% for category in categories %}
            <li class="search-facet-item is-active"><a href="{% url 'results' %}?q={{search_query}}{% for c in categories %}{% if c != category %}&amp;category={{c}}{% endif %}{% endfor %}">{% with facet=category_facets.types|array_value:category %}{{ facet.display_text }} ({{ facet.doc_count }}){% endwith %}</a></li>
          {% endfor %}
          <!-- Display categories that are still available -->
          {% for type, value in category_facets.items %}
            {% for type_facet in value %}
              {% if type_facet.key not in categories %}
                <li class="search-facet-item"><a href="{% url 'results' %}?q={{search_query}}{% for c in categories %}&amp;category={{c}}{% endfor %}&amp;category={{type_facet.key}}">{{ type_facet.display_text }} ({{ type_facet.doc_count}})</a></li>
              {% endif %}
            {% endfor %}
          {% endfor %}
        </ul>
      </div>

      <!-- Display facets available for each category -->
      {% for cat, value in sub_facets.items %}
        {% for sub_cat in value %}
          {% for key, value in sub_cat.items %}
           <div class="search-facet-section">
            <h6 class="search-facet-title">{{key}}:</h6>
            <ul class="search-facet-list">
              {% for f in value %}
              <li class="search-facet-item">
                <a href="#0">{{f.display_text}} ({{f.doc_count}})</a>
              </li>
              {% endfor %}
            </ul>
          </div>
          {% endfor %}
        {% endfor %}
      {% endfor %}
    </div>

  </aside>

</div>
{% endblock %}
